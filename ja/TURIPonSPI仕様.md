# TURIPonSPI仕様

## 概要

TURIPonSPIは、SPI上でTURIPを機能させるための仕様です。
TURIPのプロトコルスタックの中で最も単純な仕様となります。

## 物理的仕様

TURIPonSPIは明確な物理仕様を有しません。
ただし、参考として標準的な物理仕様を示します。

### 標準的な物理仕様

電源電圧およびロジックレベルは3.3Vです。
ピンアサインは次の通りとなります。

| ピン番号 | ピン名称       | 説明                                      |
|----------|----------------|-------------------------------------------|
| 1        | PIN_SPI_5V     | 電源(5V)                                  |
| 2        | PIN_SPI_MISO   | SPIのMISO                                 |
| 3        | PIN_SPI_3V3    | 電源(3.3V)                                |
| 4        | PIN_SPI_SCK    | SPIのクロック(SCK)                        |
| 5        | PIN_SPI_MOSI   | SPIのMOSI                                 |
| 6        | PIN_SPI_SS     | SPIのスレーブセレクト(SS)                 |
| 7        | PIN_SPI_GND    | グラウンド                                |
| 8        | PIN_SPI_SS_HUB | SPIのハブ機能利用時のスレーブセレクト(SS) |


## ロジック仕様

TURIPonSPIはSPIモード0で動作します。
クロック速度は`PORT_SPI_MAX_SPEED`で最大値が決められています。
また、1バイト転送毎に`PORT_SPI_MIN_DELAY`で定められる期間を空けなければなりません。

## データフォーマット

### リクエストのフォーマット

#### ヘッダ部

リクエストのヘッダは1byteで構成されています。
1ビット目（MSB）でRead/Writeを指定します。 '0'でRead、'1'でWriteです。
2ビット目以降はポート番号の指定です。

#### 受信待機、受信時(Read時)

'0xff'を送信し続けます。

#### データ部(Write時)

データはMSB Frist、リトルエンディアンです。
stringの場合、文字列の最後に'\0'を付加します。

### レスポンスのフォーマット

#### ヘッダ部

レスポンスのヘッダは1byteで構成されます。
1ビット目（MSB）は'0'固定です。
2ビット目は通信の成否を示します。'0'で成功、'1'で失敗です。
3-4ビットは予約領域です。
下位4ビットはそのポートのデータ型を示します。

| データ型    | [4..7] |
|-------------|--------|
| (undefined) | 0x0    |
| bool        | 0x1    |
| int8        | 0x2    |
| int16       | 0x3    |
| int32(int)  | 0x4    |
| int64       | 0x5    |
| float       | 0xc    |
| double      | 0xd    |
| string      | 0xe    |

#### データ部

リクエスト時と同じです。
データ部の転送終了後は次の要求があるまで'0xff'を応答し続けます。
