# TURIPonSPI仕様

## 概要

TURIPonSPIは、SPI上でTURIPを機能させるための仕様です。
TURIPのプロトコルスタックの中で最も単純な仕様となります。

## 物理的仕様

TURIPonSPIの標準的なコネクタとしてJST-GHコネクタを推奨します。
ピンアサインは次の通りとなります。

ピン番号 | 機能
-------|-----
1      | MISO
2      | 3.3V
3      | SCK
4      | MOSI
5      | SS
6      | GND

ただし、必要に応じてコネクタは自由に選定することができます。
電源電圧およびロジック電圧は3.3Vです。

## ロジック仕様

TURIPonSPIはSPIモード0で動作します。
クロック速度は200kbps以下です。
また、1バイト転送の毎に100μsec空けなければなりません。

## データフォーマット

### リクエストのフォーマット

#### ヘッダ部

リクエストのヘッダは1byteで構成されています。
1ビット目（MSB）でRead/Writeを指定します。 '0'でRead、'1'でWriteです。
2ビット目以降はポート番号の指定です。

#### 受信待機、受信時(Read時)

'0xff'を送信し続けます。

#### データ部(Write時)

データはMSB Frist、リトルエンディアンです。
stringの場合、文字列の最後に'\0'を付加します。

### レスポンスのフォーマット

#### ヘッダ部

レスポンスのヘッダは1byteで構成されます。
1ビット目（MSB）は'0'固定です。
2ビット目は通信の成否を示します。'0'で成功、'1'で失敗です。
3-4ビットは予約領域です。
下位4ビットはそのポートのデータ型を示します。

| データ型    | [4..7] |
|-------------|--------|
| (undefined) | 0x0    |
| bool        | 0x1    |
| int8        | 0x2    |
| int16       | 0x3    |
| int32(int)  | 0x4    |
| int64       | 0x5    |
| float       | 0xc    |
| double      | 0xd    |
| string      | 0xe    |

#### データ部

リクエスト時と同じです。
データ部の転送終了後は次の要求があるまで'0xff'を応答し続けます。
