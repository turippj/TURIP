# TURIPonSPI 仕様

作成者: 影山 智明  
更新日: 2017年4月4日

## 概要

TURIPonSPIは、SPI上でTURIPを機能させるための仕様です。
TURIPのプロトコルスタックの中で最も単純な仕様となります。

## コネクタ

TURIPデバイスへの接続は、6ピンコネクタを用いて接続します。
対応しているコネクタは次に挙げる通りです。

  * 2x3 2.54mmピッチボックスヘッダ
  * JST GHコネクタ

ピンアサインは次の通りとなります。
このピンアサインはICSPと互換性があります。

ピン番号 | 機能
-------|-----
1      | MISO
2      | 3.3V
3      | SCK
4      | MOSI
5      | SS
6      | GND

## 電気的仕様

電源電圧およびロジックレベルは3.3Vです。
詳細な仕様を以下に示します。

項目             | 記号   | typ. | min | max | 単位 |
----------------|-------|------|-----|-----|-----|
電源電圧          | Vcc   | 3.3  | 3.0 | 3.5 | V   |
供給電流          | Im    | -    | -   | 1.0 | A   |
ロジック電圧(High) | Vhigh | 3.3  | 2.5 | Vcc | V   |
ロジック電圧(Low)  | Vlow  | 0.0  | 0.0 | 0.5 | V   |

## ロジック仕様

TURIPonSPIはSPIモード0で動作します。
クロック速度は200kbps以下です。
また、1バイト転送の毎に100μsec空けなければなりません。

## データフォーマット

### ヘッダのフォーマット

レスポンスのヘッダは1byteで構成されます。
1ビット目（MSB）は'0'固定です。
2ビット目は通信の成否を示します。'0'で成功、'1'で失敗です。
3-4ビットは予約領域です。
下位4ビットはそのポートのデータ型を示します。

| データ型    | [4..7] |
|-------------|--------|
| (undefined) | 0x0    |
| bool        | 0x1    |
| int8        | 0x2    |
| int16       | 0x3    |
| int32(int)  | 0x4    |
| int64       | 0x5    |
| float       | 0xc    |
| double      | 0xd    |
| string      | 0xe    |
