# Tiny Universal (Tottori University) Robot Interface Protocol (TURIP) 0.20 基本仕様書

作成者: 影山 智明
更新日: 2017年4月7日

## TURIPの概要

Tiny Universal (Tottori University) Robot Interface Protocol (以下、TURIP)は、様々な電子モジュールの仕様を共通化することで、開発における技術的難度の低減および期間の短縮を目的とした電気的インターフェイスおよびデータシート仕様です。
また、さまざまなプロトコルを統合する、ラッパープロトコルでもあります。

## 用語の定義

TURIPにおける用語の独特な表現について補足します。

  * 電子モジュール
    - 特定の機能を有する小規模な電子回路であり、外部との通信機能を有するもの。
  * TURIPデバイス
    - TURIPに対応した電子モジュール
  * ポート
    - TURIPデバイス内に保持されているデータの選択を行うための機構。
  * マニフェスト(Manifest)
    - TURIPデバイスの仕様を記述したJSON形式のテキストデータ。
  * 下層プロトコル
    - TURIPがラップするプロトコル。
    - 対象となるプロトコルの元々のレイヤの上下は関係ありません。

## TURIPデータ型

TURIPでは、予め決められたデータ型を有するデータを交換することができます。
これをTURIPデータ型と呼びます。
TURIPデータ型の種類は以下に示す通りです。

| 名称        | 仕様                  |
|------------|----------------------|
| bool       | ブール型               |
| int8       | 8bit整数型             |
| int16      | 16bit整数型            |
| int32(int) | 32bit整数型            |
| int64      | 64bit整数型            |
| float      | 単精度(32bit)浮動小数点型 |
| double     | 倍精度(64bit)浮動小数点型 |
| string     | テキスト               |

## ポート

TURIPはTURIPデバイス内部に構築された「ポート」にアクセスすることでデータ交換を実現しています。
ポートにはそれぞれ一つずつ、TURIPデータ型に適合するデータが格納されています。
ポートの範囲は0から127までです。
ポートには本仕様書によって定義されているポートと、自由に定義できるポートがあります。
ポートの定義を以下に示します。

番号       | データ型   | 機能
----------|----------|------------------
0x00      | -        | デバイスリセット
0x00-0x3f | (任意)    | 自由に定義可能
0x40      | int32    | 型番
0x41-0x43 | -        | 予約
0x44      | int32    | シリアル番号
0x45-0x47 | -        | 予約
0x48      | int8     | ローカルアドレス
0x49-0x7e | -        | TURIP拡張仕様領域
0x7f      | -        | null(機能なし)

0x00-0x3fの範囲は、マニフェストによって定義されます。
0x48-0x7eの領域は、「TURIP拡張仕様」に示します。

## 下層プロトコルとの連携

TURIPは複数の下層プロトコルに対応しています。
それぞれの下層プロトコルにおける仕様は、別紙で定義します。

下層プロトコル    | ドキュメントタイトル
---------------|------------------
SPI            | TURIPonSPI 仕様
UART           | TURIPonUART 仕様
HTTP           | TURIPonHTTP 仕様

## バイナリインターフェイス/テキストインターフェイス

TURIPには「バイナリインターフェイス」と「テキストインターフェイス」が存在します。
バイナリインターフェイスは軽量性を重視しており、マイコン-センサデバイス間等の通信に有利です。
テキストインターフェイスは柔軟性を重視しており、コンピュータ間の通信、中・長距離の通信に有利です。
それぞれでインターフェイスで用いる下位プロトコルは決まっています。

- バイナリインターフェイス
  - SPI
  - I2C（TWI）
- テキストインターフェイス
  - UART
  - HTTP

## マニフェスト(Manifest)

TURIPモジュールは、マニフェスト(Manifest)と呼ばれるドキュメントでその仕様を表現することが可能です。
Manifestは型番毎に定義され、公式にはTURIP associationのマニフェストリポジトリ(http(s)://manifest.turip.org)に登録されています。
Manifestの取得はHTTP GETメソッドによって、[http(s)://manifest.turip.org/(型番)]にアクセスします。
型番は16進数表記です。
ManifestはUTF-8で記述されており、JSON形式のメタ化されたテキストデータです。
詳細は「TURIPManifest仕様.md」で定義します。

## ID

TURIPデバイスは、それぞれ固有のIDを有します。
IDは型番とシリアル番号を組み合わせた64bitの整数です。
型番は、申請毎にTURIP管理団体が発行します。
ただし、0x0001-0x0fffの範囲は、管理団体に登録せずに自由に利用可能です。
シリアル番号はベンダーが管理します。
シリアル番号を定義しない場合は、0x0000とします。

### IDの省略表示

テキストモードでは、IDを省略表記することが可能です。

`<型番>-<シリアル番号>`

それぞれ、上位の'0'は省略できます。
たとえば、型番が`0x00001234`、シリアル番号が`0x0000abcd`の場合、省略表記は
`1234-abcd`
となります。

## ローカルアドレス

ローカルアドレスは、下層でマルチバスプロトコルを用いる場合に利用します。
I2CやRS485が該当します。
このアドレスを実装する場合は、不揮発かつ変更可能でなければなりません。
